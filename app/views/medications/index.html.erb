<p class="notice-text"><%= notice %></p>

<h1>薬一覧</h1>

<!-- 🔍 検索フォーム -->
<%= form_with url: medications_path, method: :get, local: true, html: { class: "search-form" } do |f| %>
  <div class="form-group">
    <%= f.label :name, "薬名で検索" %>
    <%= f.text_field :name, value: params[:name], placeholder: "薬名を入力" %>
  </div>

  <div class="form-group">
    <%= f.label :purpose, "用途で検索" %>
    <%= f.select :purpose,
          options_for_select({
            "未設定"   => "unspecified",
            "解熱"     => "antipyretic",
            "鎮痛"     => "analgesic",
            "胃薬"     => "stomach",
            "抗生物質" => "antibiotic"
          }, params[:purpose]),
          include_blank: "すべて" %>
  </div>

  <%= f.submit "検索", class: "btn btn-primary" %>
<% end %>

<br>

<% if @medications.any? %>
  <table class="medication-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>画像</th>
        <th>薬名</th>
        <th>用量／１回</th>
        <th>服用タイミング</th>
        <th>用途</th>
        <th>備考</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @medications.each do |medication| %>
        <tr>
          <td><%= medication.id %></td>

          <!-- 画像表示 -->
          <td>
            <% if medication.image.attached? %>
              <%= image_tag medication.image, size: "100x100" %>
            <% else %>
              画像なし
            <% end %>
          </td>

          <!-- 薬名リンクで詳細へ遷移 -->
          <td><%= link_to medication.name, medication %></td>

          <td><%= medication.dosage %></td>

          <!-- 服用タイミング -->
          <td>
            <%= case medication.timing
                when "morning"    then "朝"
                when "noon"       then "昼"
                when "evening"    then "夕方"
                when "bedtime"    then "就寝前"
                when "after_meal" then "毎食後"
                else medication.timing
                end %>
          </td>

          <!-- 用途 -->
          <td>
            <%= case medication.purpose
                when "unspecified" then "未設定"
                when "antipyretic" then "解熱"
                when "analgesic"   then "鎮痛"
                when "stomach"     then "胃薬"
                when "antibiotic"  then "抗生物質"
                else "-"
                end %>
          </td>

          <!-- 備考 -->
          <td><%= medication.note.presence || "-" %></td>

          <!-- 編集・削除リンク -->
          <td>
            <%= link_to "編集", edit_medication_path(medication) %> |
            <%= link_to "削除", medication, method: :delete, data: { confirm: "本当に削除しますか？" } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="alert-text">薬が見つかりませんでした。</p>
<% end %>

<br>

<div class="action-links">
  <%= link_to "薬を新規登録", new_medication_path, class: "btn btn-success" %>
  <%= link_to "トップページへ", doctor_home_path, class: "btn btn-secondary" %>
</div>







